---
title: 计算机网络
date: 2021-03-27 23:13:11
tags: 
 - CS
categories: 
 -  ComputerScience
---
# 计算机网络
### url解析返回

1. ip解析:缓存(浏览器和操作系统)-/etc/hosts-根域名-顶级域名-权威(二级)域名

2. 网络层 ip协议 arp协议 mac地址查询

3. 传输层 TCP 连接：TCP 三次握手

4. 应用层 HTTP 连接: 发送 HTTP 请求

5. cdn直接返回/非cdn服务器监听对应端口 处理请求

6. 七层nginx负载均衡分发 静态页面直接返回 部分动态页面转发到服务器对应端口

7. k8s、docker监听端口处理

8. python网关服务器处理(ASGI/WSGI)  uWSGI/gunicorn/uvicorn

9. 框架处理（flask/django/fastapi）解析http报文 

10. 查询redis缓存/mysql

11. 组装数据并返回 HTTP 报文 json/text/file返回

12. 浏览器解析渲染页面/前端直接处理的json/xml数据

13. 断开连接：TCP 四次挥手

    

### 网络协议

1.host里面找ip没有从dns里面找

2.请求ip地址 建立连接、nginx静态模板->WSGI服务器 gunicorn ->flask web application -> 返回



- **应用层** FTP、DNS、Telnet、SMTP、HTTP
- 表示层  数据压缩，数据加密以及数据描述
- 会话层   DNS
- **传输层** tcp、udp
- **网络层** ip、ARP
- **数据链路层** PPP、FR、HDLC、VLAN、MAC  （网桥，交换机） 
- **物理层** IEEE   （中继器，集线器，网关）



### ARP协议

**即地址解析协议（Address Resolution Protocol）， 用于实现从 IP 地址到 MAC 地址的映射，即询问目标IP对应的MAC地址**。

基于功能来考虑，ARP是链路层协议；基于分层/包封装来考虑，ARP是网络层协议。



### Rpc/http区别

**http**:**有用信息占比少**，毕竟HTTP工作在第七层，包含了大量的HTTP头等信息。其次是**效率低**，还是因为第七层的缘故.

基于Restful的远程过程调用有着明显的缺点，主要是效率低、封装调用复杂。当存在大量的服务间调用时，这些缺点变得更为突出。



### DNS



### Tcp **三次握手**



其中ACK报文是用来应答的，SYN报文是用来同步的



**作用**：确认双方的接收能力和发送能力是否正常、指定自己的初始化序列号为后面的可靠性传送做准备

第一次、第二次不携带数据，防止恶意攻击



 第一次握手：[客户端]()发送syn包(syn=x)到服务器，并进入SYN_SEND状态，等待服务器确认； 

 第二次握手：服务器收到syn包，必须确认客户的SYN（ack=x+1），同时自己也发送一个SYN包（syn=y），即SYN+ACK包，此时服务器进入SYN_RECV状态； 

 第三次握手：[客户端]()收到服务器的SYN＋ACK包，向服务器发送确认包ACK(ack=y+1)，此包发送完毕，[客户端]()和服务器进入ESTABLISHED状态，完成三次握手。 

 握手过程中传送的包里不包含数据，三次握手完毕后，[客户端]()与服务器才正式开始传送数据。理想状态下，TCP连接一旦建立，在通信双方中的任何一方主动关闭连接之前，TCP 连接都将被一直保持下去。 

###  Tcp四次挥手

 与建立连接的“三次握手”类似，断开一个TCP连接则需要“四次挥手”。 

 第一次挥手：主动关闭方发送一个FIN，用来关闭主动方到被动关闭方的数据传送，也就是主动关闭方告诉被动关闭方：我已经不 会再给你发数据了(当然，在fin包之前发送出去的数据，如果没有收到对应的ack确认报文，主动关闭方依然会重发这些数据)，但是，此时主动关闭方还可 以接受数据。 

 第二次挥手：被动关闭方收到FIN包后，发送一个ACK给对方，确认序号为收到序号+1（与SYN相同，一个FIN占用一个序号）。
 第三次挥手：被动关闭方发送一个FIN，用来关闭被动关闭方到主动关闭方的数据传送，也就是告诉主动关闭方，我的数据也发送完了，不会再给你发数据了。
 第四次挥手：主动关闭方收到FIN后，发送一个ACK给被动关闭方，确认序号为收到序号+1，至此，完成四次挥手。

###  交换机

 在计算机网络系统中，交换机是针对共享工作模式的弱点而推出的。交换机拥有一条高带宽的背部总线和内部交换矩阵。交换机的所有的端口都挂接在这条背 部总线上，当控制电路收到数据包以后，处理端口会查找内存中的地址对照表以确定目的MAC（网卡的硬件地址）的NIC（网卡）挂接在哪个端口上，通过内部 交换矩阵迅速将数据包传送到目的端口。目的MAC若不存在，交换机才广播到所有的端口，接收端口回应后交换机会“学习”新的地址，并把它添加入内部地址表 中。 

 交换机工作于OSI参考模型的第二层，即数据链路层。交换机内部的CPU会在每个端口成功连接时，通过ARP协议学习它的MAC地址，保存成一张 ARP表。在今后的通讯中，发往该MAC地址的数据包将仅送往其对应的端口，而不是所有的端口。因此，交换机可用于划分数据链路层广播，即冲突域；但它不 能划分网络层广播，即广播域。 

 交换机被广泛应用于二层网络交换，俗称“二层交换机”。 

 交换机的种类有：二层交换机、三层交换机、四层交换机、七层交换机分别工作在OSI七层模型中的第二层、第三层、第四层盒第七层，并因此而得名。 

### 路由器  

 **路由器**（**Router**）是一种计算机网络设备，提供了路由与转送两种重要机制，可以决定数据包从来源端到目的端所经过 的路由路径（host到host之间的传输路径），这个过程称为路由；将路由器输入端的数据包移送至适当的路由器输出端(在路由器内部进行)，这称为转 送。路由工作在OSI模型的第三层——即网络层，例如网际协议。 

 **路由器的一个作用是连通不同的网络，另一个作用是选择信息传送的线路。** 路由器与交换器的差别，路由器是属于OSI第三层的产品，交换器是OSI第二层的产品(这里特指二层交换机)。 



### 网关 

 **网关**（Gateway），**网关**顾名思义就是连接两个网络的设备，区别于路由器（由于历史的原因，许多有关TCP/IP 的文献曾经把网络层使用的路由器（Router）称为网关，在今天很多局域网采用都是路由来接入网络，因此现在通常指的网关就是路由器的IP），经常在家 庭中或者小型企业网络中使用，用于连接局域网和Internet。 网关也经常指把一种协议转成另一种协议的设备，比如语音网关。 

 在传统TCP/IP术语中，网络设备只分成两种，一种为网关（gateway），另一种为主机（host）。网关能在网络间转递数据包，但主机不能 转送数据包。在主机（又称终端系统，end system）中，数据包需经过TCP/IP四层协议处理，但是在网关（又称中介系 统，intermediate system）只需要到达网际层（Internet layer），决定路径之后就可以转送。在当时，网关 （gateway）与路由器（router）还没有区别。 

 在现代网络术语中，网关（gateway）与路由器（router）的定义不同。网关（gateway）能在不同协议间移动数据，而路由器（router）是在不同网络间移动数据，相当于传统所说的IP网关（IP gateway）。 

 **网关**是连接两个网络的设备，对于语音网关来说，他可以连接PSTN网络和以太网，这就相当于VOIP，把不同电话中的模拟信号通过网关而转换成数字信号，而且加入协议再去传输。在到了接收端的时候再通过**网关**还原成模拟的电话信号，最后才能在电话机上听到。 

 对于以太网中的**网关**只能转发三层以上数据包，这一点和路由是一样的。而不同的是**网关**中并没有路由表，他只能按照预先设定的不同网段来进行转发。网关最重要的一点就是端口映射，子网内用户在外网看来只是外网的IP地址对应着不同的端口，这样看来就会保护子网内的用户。